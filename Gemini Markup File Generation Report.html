<!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <style>
          body {
            max-width: 880px;
            margin: 0 auto;
            padding: 2rem 80px;
            position: relative;
          }
          @media screen and (max-width: 500px) {
            body {
              padding: 1rem 16px;
            }
          }
        </style>
      <script type='text/javascript' src='https://www.genspark.ai/e5ytL1qWQNuUsPYNqP7vu3_vM4eY7xa0oLaF-mUb4RC9KX06BTLtqWpHxTVKT31pXeHHqLEksBTxH0yk1gS2peURHksYHhroDrxkz_temH-NNUqMDUOyTy60shgmONRF-a-cTTrTp8l6wy2OiJWnWrKZC9WTbcBFYaFyS-QaZ7f9NxA1lWyt8f7NWJXJtk_vKPE41nVT8xJY-zRp0qlY9q_UD2-rvh-B9dR1XFD05TOZcRKAD7DSak_W6kpJSCtXeB2Lt0a0z14ALBf6WRFSsFrv_k_fDtJv_4Hasm-Rc1lzoMs-c6TlNuOpnXLd4x4ixGLTb2rMPruxIc0lfrTb3ryGBsyG5nI3g_eTMIEyZfsrUVOTsibZo89q2L539K445_18o3YzyAaI5Fyre6-tvF-LhulKK8B26RLB8goJcva4COD3wTo5AloGpMC0hsLlKNCMW1u4LbbBxXzojnKYJte3PmhpKQwsaBPj'></script></head>
      <body>
        <h1>ğŸ”® AI íƒ€ë¡œ ë¦¬ë”© í”Œë«í¼ ì‹œìŠ¤í…œ ì„¤ê³„ ë³´ê³ ì„œ</h1>
<h2>Project: PyTarot</h2>
<hr />
<h2>ğŸ“‹ 1. í”„ë¡œì íŠ¸ ê°œìš” (Project Overview)</h2>
<h3>1.1 í”„ë¡œì íŠ¸ ëª©í‘œ (Project Goals)</h3>
<p>Python ê¸°ë°˜ AI íƒ€ë¡œ ë¦¬ë”© ì‹œìŠ¤í…œ(Web/App) ê°œë°œì„ ìœ„í•œ ì‹œìŠ¤í…œ ì„¤ê³„ë¡œ, ìµœì‹  Python íŠ¸ë Œë“œë¥¼ ë°˜ì˜í•˜ì—¬ **FastAPI(ë°±ì—”ë“œ)**ì™€ **ìƒì„±í˜• AI(LLM)**ë¥¼ ê²°í•©í•œ ê³ ë„í™”ëœ í•´ì„ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
<p><strong>í•µì‹¬ ëª©í‘œ:</strong></p>
<ul>
<li>ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥ â†’ íƒ€ë¡œ ì¹´ë“œ ì„ íƒ(ë± ì…”í”Œë§) â†’ AI ê°œì¸í™”ëœ ìš´ì„¸ ìƒë‹´ ì œê³µ</li>
<li>ë‹¨ìˆœí•œ ëœë¤ ì¹´ë“œ ë½‘ê¸°ë¥¼ ë„˜ì–´ì„  ë§¥ë½ ê¸°ë°˜ í•´ì„ ì„œë¹„ìŠ¤</li>
</ul>
<h3>1.2 í”„ë¡œì íŠ¸ ì£¼ìš” íŠ¹ì§• (Project Key Features)</h3>
<ul>
<li>ğŸ¯ <strong>ê³ í’ˆì§ˆ ë‚œìˆ˜ ìƒì„±</strong>: <code>secrets</code> ëª¨ë“ˆì„ í™œìš©í•œ ì§„ì •ì„± ìˆëŠ” ì…”í”Œ</li>
<li>ğŸ¤– <strong>AI ê¸°ë°˜ í•´ì„</strong>: OpenAI/Gemini API ì—°ë™ì„ í†µí•œ ë¬¸ë§¥ ê¸°ë°˜ ìì—°ì–´ í•´ì„</li>
<li>ğŸ“Š <strong>ì‚¬ìš©ì ê¸°ë¡ ê´€ë¦¬</strong>: ê°œì¸ ë¦¬ë”© ê¸°ë¡ ì €ì¥ ë° ì¶”ì„¸ ë¶„ì„</li>
<li>ğŸ”„ <strong>ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</strong>: AIê°€ íƒ€ì´í•‘í•˜ë“¯ ë‹µë³€ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œë ¥</li>
</ul>
<hr />
<h2>ğŸ› ï¸ 2. ê¸°ìˆ  ìŠ¤íƒ (Technology Stack)</h2>
<h3>2.1 ê¸°ìˆ ìŠ¤íƒ ë°±ì—”ë“œ (Technology Backend)</h3>
<p><strong>í•µì‹¬ í”„ë ˆì„ì›Œí¬:</strong></p>
<ul>
<li><strong>FastAPI</strong>: ë†’ì€ ì„±ëŠ¥, ë¹„ë™ê¸° ì²˜ë¦¬, ìë™ ë¬¸ì„œí™”</li>
<li><strong>LangChain</strong>: LLM í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ ë° ì²´ì´ë‹</li>
<li><strong>OpenAI API / Google Gemini API</strong>: AI í•´ì„ ì—”ì§„</li>
</ul>
<p><strong>ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬:</strong></p>
<ul>
<li><strong>Pillow (PIL)</strong>: ì¹´ë“œ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•, ìŠ¤í”„ë ˆë“œ ì´ë¯¸ì§€ í•©ì„±</li>
<li><strong>NumPy &amp; Secrets</strong>: ì •ë°€í•œ ì…”í”Œ ì•Œê³ ë¦¬ì¦˜</li>
<li><strong>SQLAlchemy</strong>: Python ê°ì²´ì™€ DB ë§¤í•‘ì„ ìœ„í•œ ORM</li>
</ul>
<h3>2.2 ê¸°ìˆ ìŠ¤íƒ ë°ì´í„°ë² ì´ìŠ¤ (Technology Database)</h3>
<ul>
<li><strong>PostgreSQL</strong>: ì‚¬ìš©ì ì •ë³´, ë¦¬ë”© ê¸°ë¡, ì¹´ë“œ ë©”íƒ€ë°ì´í„° ì €ì¥</li>
<li><strong>SQLAlchemy</strong>: Python ê°ì²´ ê´€ê³„ ë§¤í•‘</li>
</ul>
<h3>2.3 ê¸°ìˆ ìŠ¤íƒ í”„ë¡ íŠ¸ì—”ë“œ ì˜µì…˜ (Technology Frontend Options)</h3>
<p><strong>ì˜µì…˜ 1 (Full Python):</strong></p>
<ul>
<li><strong>Streamlit</strong> ë˜ëŠ” <strong>NiceGUI</strong>: ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘ìš©</li>
</ul>
<p><strong>ì˜µì…˜ 2 (ìƒìš© ì„œë¹„ìŠ¤ê¸‰):</strong></p>
<ul>
<li><strong>React.js</strong> ë˜ëŠ” <strong>Flutter</strong>(ì•±): FastAPIì™€ REST API í†µì‹ </li>
</ul>
<hr />
<h2>ğŸ—ï¸ 3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (System Architecture)</h2>
<h3>3.1 ì•„í‚¤í…ì²˜ ì „ì²´ êµ¬ì¡° (Architecture Overview)</h3>
<p>ì „ì²´ ì‹œìŠ¤í…œì€ <strong>Client-Server êµ¬ì¡°</strong>ë¥¼ ë”°ë¥´ë©°, AI í•´ì„ ì—”ì§„ì´ ë³„ë„ì˜ ëª¨ë“ˆë¡œ í†µí•©ë©ë‹ˆë‹¤.</p>
<h3>3.2 ì•„í‚¤í…ì²˜ ê³„ì¸µ êµ¬ì¡° (Architecture Layer Structure)</h3>
<h4>3.2.1 ì•„í‚¤í…ì²˜ í´ë¼ì´ì–¸íŠ¸ ë ˆì´ì–´ (Architecture Client Layer)</h4>
<ul>
<li>ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ (ì¹´ë“œ ì„ íƒ, ì§ˆë¬¸ ì…ë ¥, ê²°ê³¼ ì¡°íšŒ)</li>
</ul>
<h4>3.2.2 ì•„í‚¤í…ì²˜ API ê²Œì´íŠ¸ì›¨ì´ (Architecture API Gateway)</h4>
<ul>
<li>ì¸ì¦, ìš”ì²­ ì†ë„ ì œí•œ (Rate Limiting)</li>
</ul>
<h4>3.2.3 ì•„í‚¤í…ì²˜ ì„œë¹„ìŠ¤ ë ˆì´ì–´ (Architecture Service Layer)</h4>
<p><strong>í•µì‹¬ ë¡œì§:</strong></p>
<ul>
<li><strong>Deck Service</strong>: ë± ì´ˆê¸°í™”, ì…”í”Œ, ì¹´ë“œ ë½‘ê¸° ë¡œì§</li>
<li><strong>Interpretation Service</strong>: ë½‘íŒ ì¹´ë“œ + ì§ˆë¬¸ + ì¹´ë“œ ìœ„ì¹˜ë¥¼ ì¡°í•©í•˜ì—¬ LLMì— í”„ë¡¬í”„íŠ¸ ì „ì†¡</li>
<li><strong>User Service</strong>: íšŒì›ê°€ì…, ë¡œê·¸ì¸, ê¸°ë¡ ê´€ë¦¬</li>
</ul>
<h4>3.2.4 ì•„í‚¤í…ì²˜ ë°ì´í„° ë ˆì´ì–´ (Architecture Data Layer)</h4>
<ul>
<li>PostgreSQL DB ë° ì¹´ë“œ ì´ë¯¸ì§€ ì €ì¥ì†Œ (S3 or Local)</li>
</ul>
<hr />
<h2>âš™ï¸ 4. í•µì‹¬ ë¡œì§ ë° ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„ (Core Logic &amp; Algorithm)</h2>
<h3>4.1 ë¡œì§ ì…”í”Œ ë° ë“œë¡œìš° (Logic Shuffling &amp; Drawing)</h3>
<p>ìš´ì„¸ í”„ë¡œê·¸ë¨ì˜ 'ìš°ì—°ì„±'ì„ ê°•ì¡°í•˜ê¸° ìœ„í•´ ì•”í˜¸í•™ì ìœ¼ë¡œ ì•ˆì „í•œ ë‚œìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<pre><code class="language-python">import secrets

def shuffle_deck(deck: list) -&gt; list:
    &quot;&quot;&quot;
    secrets ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ì…”í”Œ êµ¬í˜„
    &quot;&quot;&quot;
    shuffled = deck[:]
    # Fisher-Yates shuffle ì•Œê³ ë¦¬ì¦˜ ë³€í˜• ì ìš©
    for i in range(len(shuffled) - 1, 0, -1):
        j = secrets.randbelow(i + 1)
        shuffled[i], shuffled[j] = shuffled[j], shuffled[i]
    return shuffled

def draw_cards(shuffled_deck: list, count: int) -&gt; list:
    &quot;&quot;&quot;
    ì…”í”Œëœ ë±ì—ì„œ ì§€ì •ëœ ìˆ˜ë§Œí¼ ì¹´ë“œë¥¼ ë½‘ëŠ” í•¨ìˆ˜
    &quot;&quot;&quot;
    return shuffled_deck[:count]
</code></pre>
<h3>4.2 ë¡œì§ ìŠ¤í”„ë ˆë“œ ì‹œìŠ¤í…œ (Logic Spread System)</h3>
<p>ë‹¤ì–‘í•œ ë°°ì—´ë²•(Spread)ì„ ì¢Œí‘œ ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
<p><strong>ìŠ¤í”„ë ˆë“œ íƒ€ì…:</strong></p>
<ul>
<li><strong>1ì¹´ë“œ (One Card)</strong>: ì˜¤ëŠ˜ì˜ ìš´ì„¸, Yes/No ì§ˆë¬¸</li>
<li><strong>3ì¹´ë“œ (Three Card)</strong>: ê³¼ê±° / í˜„ì¬ / ë¯¸ë˜</li>
<li><strong>ì¼ˆí‹± í¬ë¡œìŠ¤ (Celtic Cross)</strong>: ì‹¬ì¸µ ë¶„ì„ (10ì¥ ë°°ì—´)</li>
</ul>
<pre><code class="language-python">class SpreadType:
    ONE_CARD = {
        &quot;name&quot;: &quot;ì›ì¹´ë“œ&quot;,
        &quot;positions&quot;: [{&quot;index&quot;: 0, &quot;meaning&quot;: &quot;í˜„ì¬ ìƒí™©&quot;}],
        &quot;card_count&quot;: 1
    }
  
    THREE_CARD = {
        &quot;name&quot;: &quot;ì“°ë¦¬ì¹´ë“œ&quot;,
        &quot;positions&quot;: [
            {&quot;index&quot;: 0, &quot;meaning&quot;: &quot;ê³¼ê±°&quot;},
            {&quot;index&quot;: 1, &quot;meaning&quot;: &quot;í˜„ì¬&quot;}, 
            {&quot;index&quot;: 2, &quot;meaning&quot;: &quot;ë¯¸ë˜&quot;}
        ],
        &quot;card_count&quot;: 3
    }
  
    CELTIC_CROSS = {
        &quot;name&quot;: &quot;ì¼ˆí‹± í¬ë¡œìŠ¤&quot;,
        &quot;positions&quot;: [
            {&quot;index&quot;: 0, &quot;meaning&quot;: &quot;í˜„ì¬ ìƒí™©&quot;},
            {&quot;index&quot;: 1, &quot;meaning&quot;: &quot;ë„ì „ê³¼ ì¥ì• ë¬¼&quot;},
            # ... ì´ 10ê°œ ìœ„ì¹˜
        ],
        &quot;card_count&quot;: 10
    }
</code></pre>
<h3>4.3 ë¡œì§ AI í•´ì„ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ (Logic AI Prompt Engineering)</h3>
<p>LangChainì„ í™œìš©í•œ ìŠ¤í† ë¦¬í…”ë§ ê¸°ë°˜ í•´ì„ ì‹œìŠ¤í…œ:</p>
<pre><code class="language-python">from langchain.prompts import PromptTemplate

tarot_interpretation_prompt = PromptTemplate(
    input_variables=[&quot;question&quot;, &quot;cards_info&quot;, &quot;spread_type&quot;],
    template=&quot;&quot;&quot;
    ë‹¹ì‹ ì€ ì‹ ë¹„ë¡œìš´ íƒ€ë¡œ ë¦¬ë”ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ '{question}'ë¼ê³  ë¬¼ì—ˆìŠµë‹ˆë‹¤.
  
    ì„ íƒëœ ìŠ¤í”„ë ˆë“œ: {spread_type}
  
    ë½‘íŒ ì¹´ë“œë“¤:
    {cards_info}
  
    ì´ ì¹´ë“œë“¤ì˜ ê´€ê³„ë¥¼ ì—°ê²°í•˜ì—¬ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•œ ì¡°ì–¸ê³¼ 
    ë¯¸ë˜ ì˜ˆì¸¡ì„ ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ ì–´ì¡°ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
  
    ì‘ë‹µ êµ¬ì¡°:
    1. ì¹´ë“œë“¤ì˜ ì „ì²´ì ì¸ ë©”ì‹œì§€
    2. ê° ìœ„ì¹˜ë³„ ì¹´ë“œì˜ ì˜ë¯¸ì™€ í•´ì„
    3. ì¢…í•©ì ì¸ ì¡°ì–¸ê³¼ ê°€ì´ë˜ìŠ¤
    &quot;&quot;&quot;
)
</code></pre>
<hr />
<h2>ğŸ—„ï¸ 5. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (Database Design)</h2>
<h3>5.1 ë°ì´í„°ë² ì´ìŠ¤ ERD ìŠ¤í‚¤ë§ˆ (Database ERD Schema)</h3>
<p>ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ìœ„í•œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°:</p>
<table>
<thead>
<tr>
<th>Table Name</th>
<th>Description</th>
<th>Key Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Users</strong></td>
<td>ì‚¬ìš©ì ì •ë³´</td>
<td><code>user_id</code>, <code>email</code>, <code>nickname</code>, <code>birth_date</code>, <code>created_at</code></td>
</tr>
<tr>
<td><strong>TarotCards</strong></td>
<td>78ì¥ ì¹´ë“œ ì •ë³´</td>
<td><code>card_id</code>, <code>name_en</code>, <code>name_kr</code>, <code>image_url</code>, <code>basic_keywords</code>, <code>element</code>, <code>suit</code></td>
</tr>
<tr>
<td><strong>Readings</strong></td>
<td>ë¦¬ë”© ì„¸ì…˜ ê¸°ë¡</td>
<td><code>reading_id</code>, <code>user_id</code>, <code>question</code>, <code>spread_type</code>, <code>created_at</code>, <code>ai_summary</code></td>
</tr>
<tr>
<td><strong>ReadingDetails</strong></td>
<td>ì„¸ì…˜ë³„ ì¹´ë“œ ìƒì„¸</td>
<td><code>detail_id</code>, <code>reading_id</code>, <code>card_id</code>, <code>position_index</code>, <code>is_reversed</code></td>
</tr>
</tbody>
</table>
<h3>5.2 ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„¸ (Database Table Details)</h3>
<pre><code class="language-sql">-- Users í…Œì´ë¸”
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    nickname VARCHAR(100) NOT NULL,
    birth_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- TarotCards í…Œì´ë¸”  
CREATE TABLE tarot_cards (
    card_id SERIAL PRIMARY KEY,
    name_en VARCHAR(100) NOT NULL,
    name_kr VARCHAR(100) NOT NULL,
    image_url VARCHAR(500),
    basic_keywords TEXT,
    element VARCHAR(50),
    suit VARCHAR(50),
    card_number INTEGER
);

-- Readings í…Œì´ë¸”
CREATE TABLE readings (
    reading_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id),
    question TEXT NOT NULL,
    spread_type VARCHAR(50) NOT NULL,
    ai_summary TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ReadingDetails í…Œì´ë¸”
CREATE TABLE reading_details (
    detail_id SERIAL PRIMARY KEY,
    reading_id INTEGER REFERENCES readings(reading_id),
    card_id INTEGER REFERENCES tarot_cards(card_id),
    position_index INTEGER NOT NULL,
    is_reversed BOOLEAN DEFAULT FALSE
);
</code></pre>
<hr />
<h2>ğŸ”Œ 6. API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„ (API Endpoint Design)</h2>
<h3>6.1 API RESTful ì—”ë“œí¬ì¸íŠ¸ (API RESTful Endpoints)</h3>
<h4>6.1.1 API ì¹´ë“œ ê´€ë¦¬ ì—”ë“œí¬ì¸íŠ¸ (API Card Management)</h4>
<pre><code class="language-http">GET /api/cards
</code></pre>
<ul>
<li><strong>ì„¤ëª…</strong>: ì „ì²´ íƒ€ë¡œ ì¹´ë“œ ë©”íƒ€ë°ì´í„° ì¡°íšŒ (ìºì‹± ê¶Œì¥)</li>
<li><strong>ì‘ë‹µ</strong>: 78ì¥ ì¹´ë“œ ì •ë³´ JSON ë°°ì—´</li>
</ul>
<h4>6.1.2 API ë¦¬ë”© ì„¸ì…˜ ì—”ë“œí¬ì¸íŠ¸ (API Reading Session)</h4>
<p><strong>ë± ì…”í”Œ ìš”ì²­:</strong></p>
<pre><code class="language-http">POST /api/reading/shuffle
</code></pre>
<ul>
<li><strong>ìš”ì²­ ë³¸ë¬¸</strong>: <code>{&quot;user_id&quot;: &quot;123&quot;}</code></li>
<li><strong>ì‘ë‹µ</strong>: <code>{&quot;session_id&quot;: &quot;uuid-string&quot;, &quot;status&quot;: &quot;shuffled&quot;}</code></li>
</ul>
<p><strong>ì¹´ë“œ ë½‘ê¸° ìš”ì²­:</strong></p>
<pre><code class="language-http">POST /api/reading/draw
</code></pre>
<ul>
<li><strong>ìš”ì²­ ë³¸ë¬¸</strong>:</li>
</ul>
<pre><code class="language-json">{
    &quot;session_id&quot;: &quot;uuid-string&quot;,
    &quot;spread_type&quot;: &quot;three_card&quot;,
    &quot;question&quot;: &quot;ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë–¨ê¹Œìš”?&quot;
}
</code></pre>
<ul>
<li><strong>ì‘ë‹µ</strong>: ì„ íƒëœ ì¹´ë“œ ID ë¦¬ìŠ¤íŠ¸ ë° ì´ë¯¸ì§€ URL</li>
</ul>
<p><strong>AI í•´ì„ ìš”ì²­:</strong></p>
<pre><code class="language-http">POST /api/reading/interpret
</code></pre>
<ul>
<li><strong>íŠ¹ì§•</strong>: Server-Sent Eventsë¥¼ í†µí•œ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ</li>
<li><strong>ì‘ë‹µ</strong>: AIê°€ íƒ€ì´í•‘í•˜ë“¯ ì ì§„ì  ë‹µë³€ ì¶œë ¥</li>
</ul>
<h4>6.1.3 API ì‚¬ìš©ì ê¸°ë¡ ì—”ë“œí¬ì¸íŠ¸ (API User History)</h4>
<pre><code class="language-http">GET /api/history/{user_id}
</code></pre>
<ul>
<li><strong>ì„¤ëª…</strong>: ê³¼ê±° ë¦¬ë”© ê¸°ë¡ ì¡°íšŒ</li>
<li><strong>ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°</strong>: <code>limit</code>, <code>offset</code>, <code>date_from</code>, <code>date_to</code></li>
</ul>
<hr />
<h2>ğŸš€ 7. ê°œë°œ ë¡œë“œë§µ (Development Roadmap)</h2>
<h3>7.1 ë¡œë“œë§µ 1ë‹¨ê³„: ê¸°ë°˜ êµ¬ì¶• (Roadmap Phase 1: Foundation)</h3>
<ul>
<li>78ì¥ íƒ€ë¡œ ì¹´ë“œ ë°ì´í„°(JSON) êµ¬ì¶• ë° ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤ í™•ë³´</li>
<li>FastAPI ê¸°ë³¸ ì„œë²„ ì„¸íŒ… ë° PostgreSQL ì—°ê²°</li>
<li><strong>ì˜ˆìƒ ê¸°ê°„</strong>: 2ì£¼</li>
</ul>
<h3>7.2 ë¡œë“œë§µ 2ë‹¨ê³„: ì½”ì–´ ë¡œì§ (Roadmap Phase 2: Core Logic)</h3>
<ul>
<li><code>secrets</code> ê¸°ë°˜ ì…”í”Œ ë¡œì§ êµ¬í˜„</li>
<li>ìŠ¤í”„ë ˆë“œ ì¢Œí‘œ ì‹œìŠ¤í…œ ê°œë°œ</li>
<li>ì¹´ë“œ ë½‘ê¸° ë° ìœ„ì¹˜ ë§¤í•‘ ë¡œì§</li>
<li><strong>ì˜ˆìƒ ê¸°ê°„</strong>: 2ì£¼</li>
</ul>
<h3>7.3 ë¡œë“œë§µ 3ë‹¨ê³„: AI ì—°ë™ (Roadmap Phase 3: AI Integration)</h3>
<ul>
<li>OpenAI API ì—°ë™ ë° í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</li>
<li>LangChainì„ í†µí•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ê´€ë¦¬</li>
<li>AI í™˜ê° í˜„ìƒ ì œì–´ ë° í’ˆì§ˆ ê²€ì¦</li>
<li><strong>ì˜ˆìƒ ê¸°ê°„</strong>: 3ì£¼</li>
</ul>
<h3>7.4 ë¡œë“œë§µ 4ë‹¨ê³„: í´ë¼ì´ì–¸íŠ¸ ê°œë°œ (Roadmap Phase 4: Client Development)</h3>
<ul>
<li>ì›¹/ì•± UI ê°œë°œ</li>
<li>API ì—°ë™ ë° ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„</li>
<li>ì‚¬ìš©ì ê²½í—˜(UX) ìµœì í™”</li>
<li><strong>ì˜ˆìƒ ê¸°ê°„</strong>: 4ì£¼</li>
</ul>
<h3>7.5 ë¡œë“œë§µ 5ë‹¨ê³„: ë°°í¬ ë° ìš´ì˜ (Roadmap Phase 5: Deployment)</h3>
<ul>
<li>Docker ì»¨í…Œì´ë„ˆí™”</li>
<li>í´ë¼ìš°ë“œ(AWS/GCP) ë°°í¬</li>
<li>ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•</li>
<li><strong>ì˜ˆìƒ ê¸°ê°„</strong>: 2ì£¼</li>
</ul>
<hr />
<h2>ğŸ’¡ 8. ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ (Next Steps Suggestion)</h2>
<h3>8.1 ì œì•ˆ ìš°ì„ ìˆœìœ„ ì˜µì…˜ (Suggestion Priority Options)</h3>
<p><strong>ì˜µì…˜ A: MVP í”„ë¡œí† íƒ€ì… ê°œë°œ</strong></p>
<ul>
<li>FastAPI ê¸°ë°˜ í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„</li>
<li>ê¸°ë³¸ ì…”í”Œ ë¡œì§ ë° API ì—”ë“œí¬ì¸íŠ¸ ê°œë°œ</li>
<li><strong>ì˜ˆìƒ ì†Œìš”</strong>: 1ì£¼</li>
</ul>
<p><strong>ì˜µì…˜ B: ë°ì´í„°ë² ì´ìŠ¤ ìƒì„¸ ì„¤ê³„</strong></p>
<ul>
<li>PostgreSQL ìŠ¤í‚¤ë§ˆ ì™„ì„±</li>
<li>ìƒ˜í”Œ ë°ì´í„° ìƒì„± ë° ì‹œë“œ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±</li>
<li><strong>ì˜ˆìƒ ì†Œìš”</strong>: 3-4ì¼</li>
</ul>
<p><strong>ì˜µì…˜ C: AI í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì—°êµ¬</strong></p>
<ul>
<li>ë‹¤ì–‘í•œ LLM ëª¨ë¸ í…ŒìŠ¤íŠ¸ ë° ë¹„êµ</li>
<li>ìµœì  í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ê°œë°œ</li>
<li><strong>ì˜ˆìƒ ì†Œìš”</strong>: 1ì£¼</li>
</ul>
<h3>8.2 ì œì•ˆ ê¶Œì¥ ì‹œì‘ì  (Suggestion Recommended Starting Point)</h3>
<p><strong>1ìˆœìœ„</strong>: MVP í”„ë¡œí† íƒ€ì… ê°œë°œë¡œ í•µì‹¬ ê¸°ëŠ¥ ê²€ì¦ í›„ ì ì§„ì  í™•ì¥<br />
<strong>2ìˆœìœ„</strong>: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ì™„ë£Œë¡œ ì•ˆì •ì ì¸ ë°ì´í„° êµ¬ì¡° í™•ë¦½</p>
<hr />
<h2>ğŸ“Š 9. ì˜ˆìƒ ì„±ê³¼ ë° ê¸°ëŒ€íš¨ê³¼ (Expected Results)</h2>
<h3>9.1 ì„±ê³¼ ê¸°ìˆ ì  ì„±ê³¼ (Results Technical Achievement)</h3>
<ul>
<li><strong>ê³ ì„±ëŠ¥</strong>: FastAPIì˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ë™ì‹œ ì‚¬ìš©ì 1000ëª…+ ì§€ì›</li>
<li><strong>í™•ì¥ì„±</strong>: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ ëª¨ë“ˆë³„ ë…ë¦½ì  í™•ì¥ ê°€ëŠ¥</li>
<li><strong>ì‹ ë¢°ì„±</strong>: <code>secrets</code> ëª¨ë“ˆì„ í†µí•œ ì§„ì •í•œ ëœë¤ì„± í™•ë³´</li>
</ul>
<h3>9.2 ì„±ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜ (Results Business Value)</h3>
<ul>
<li><strong>ê°œì¸í™”</strong>: AI ê¸°ë°˜ ë§ì¶¤í˜• í•´ì„ìœ¼ë¡œ ì‚¬ìš©ì ë§Œì¡±ë„ ì¦ëŒ€</li>
<li><strong>ë°ì´í„° ìì‚°</strong>: ì‚¬ìš©ì ë¦¬ë”© íŒ¨í„´ ë¶„ì„ì„ í†µí•œ ì¸ì‚¬ì´íŠ¸ ë°œêµ´</li>
<li><strong>í™•ì¥ ê°€ëŠ¥</strong>: ë‹¤ë¥¸ ì ìˆ  ë¶„ì•¼(ì‚¬ì£¼, íƒ€ë¡œ ë“±)ë¡œ í”Œë«í¼ í™•ì¥ ê°€ëŠ¥</li>
</ul>
<hr />
<p><em>ì´ ì„¤ê³„ ë³´ê³ ì„œëŠ” Python ìµœì‹  íŠ¸ë Œë“œì™€ AI ê¸°ìˆ ì„ ê²°í•©í•œ í˜ì‹ ì ì¸ íƒ€ë¡œ ë¦¬ë”© í”Œë«í¼ êµ¬ì¶•ì„ ìœ„í•œ ì¢…í•©ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤.</em></p>
<hr />
<h1>ğŸ“œ Part 2: ì‹¬í™” ê¸°ìˆ  ëª…ì„¸ì„œ</h1>
<h2>PyTarot Intelligent System - ìƒìš©í™” ê¸°ìˆ  ëª…ì„¸</h2>
<p><strong>ì„¤ê³„ ì² í•™</strong>: ë‹¨ìˆœí•œ ê°œë°œ ê³„íšì„ ë„˜ì–´ ì‹¤ì œ ìƒìš©í™” ê°€ëŠ¥í•œ ìˆ˜ì¤€ì˜ ê¸°ìˆ ì  ê¹Šì´ë¥¼ ë‹´ì€ ëª…ì„¸ì„œì…ë‹ˆë‹¤. ê° ë‹¨ê³„ëŠ” **ë°ì´í„°(Data) â†’ ë°±ì—”ë“œ(Backend) â†’ ì§€ëŠ¥(Intelligence) â†’ ì¸í”„ë¼(Infrastructure)**ì˜ ë…¼ë¦¬ì  íë¦„ì„ ë”°ë¥´ë©°, í˜„ì—… ì „ë¬¸ê°€ ìˆ˜ì¤€ì˜ ê¸°ìˆ  ìŠ¤íƒê³¼ ì•„í‚¤í…ì²˜ íŒ¨í„´ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.</p>
<hr />
<h2>ğŸ¯ Phase 1. ë°ì´í„° ëª¨ë¸ë§ ë° ì½”ì–´ ì—”ì§„ ì„¤ê³„</h2>
<h3>Phase 1 - The Foundation (ë°ì´í„° ê¸°ë°˜)</h3>
<p><strong>ëª©í‘œ:</strong> ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ê³ , íƒ€ë¡œì˜ í•µì‹¬ì¸ 'ë¬´ì‘ìœ„ì„±(Randomness)'ì„ ê¸°ìˆ ì ìœ¼ë¡œ ì™„ë²½í•˜ê²Œ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
<h4>1.1 Phase1 Advanced DB Schema (ê³ ê¸‰ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ)</h4>
<p><strong>PostgreSQL + SQLAlchemy 2.0 ê¸°ë°˜</strong></p>
<p>ë‹¨ìˆœ ì €ì¥ì´ ì•„ë‹Œ, <strong>ì‚¬ìš©ì í–‰ë™ ë¶„ì„</strong>ê³¼ <strong>í™•ì¥ì„±</strong>ì„ ê³ ë ¤í•œ ìŠ¤í‚¤ë§ˆì…ë‹ˆë‹¤.</p>
<p><strong>í•µì‹¬ í…Œì´ë¸” êµ¬ì¡°:</strong></p>
<ul>
<li><strong><code>TarotDeck</code> (Master Data)</strong>: 78ì¥ ì¹´ë“œì˜ ì •ë°©í–¥/ì—­ë°©í–¥ í‚¤ì›Œë“œ, ì›ì†Œ(ë¶ˆ/ë¬¼/ê³µê¸°/í™), ìˆ˜ë¹„í•™ì  ì˜ë¯¸, ì´ë¯¸ì§€ ê²½ë¡œë¥¼ JSONB íƒ€ì…ìœ¼ë¡œ ì €ì¥í•˜ì—¬ ìœ ì—°ì„± í™•ë³´</li>
<li><strong><code>UserProfile</code></strong>: ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´ ì™¸ì— <code>birth_chart</code>(ì ì„±ìˆ  ì—°ê³„ìš© ë°ì´í„°) ì»¬ëŸ¼ í™•ë³´</li>
<li><strong><code>ReadingSession</code></strong>: ì„¸ì…˜ ID(UUID)ë¥¼ PKë¡œ ì‚¬ìš©. ì§ˆë¬¸ í…ìŠ¤íŠ¸, ì„ íƒëœ ìŠ¤í”„ë ˆë“œ íƒ€ì…, <strong>AI ë¶„ì„ ì†Œìš” ì‹œê°„</strong>, ì‚¬ìš©ì í”¼ë“œë°±(í‰ì ) ì €ì¥</li>
<li><strong><code>CardSelection</code></strong>: ì„¸ì…˜ê³¼ 1:N ê´€ê³„. <code>position_index</code>(ê³¼ê±°/í˜„ì¬/ë¯¸ë˜ ë“± ìœ„ì¹˜), <code>orientation</code>(ì •/ì—­ë°©í–¥) ì €ì¥</li>
</ul>
<pre><code class="language-python"># SQLAlchemy 2.0 ëª¨ë¸ ì˜ˆì‹œ
from sqlalchemy import Column, Integer, String, DateTime, ForeignKey, Boolean, JSON, UUID
from sqlalchemy.orm import relationship, DeclarativeBase
from datetime import datetime
import uuid

class Base(DeclarativeBase):
    pass

class TarotDeck(Base):
    __tablename__ = &quot;tarot_deck&quot;
  
    card_id = Column(Integer, primary_key=True)
    name_en = Column(String(100), nullable=False)
    name_kr = Column(String(100), nullable=False)
    suit = Column(String(50))  # Major Arcana, Wands, Cups, Swords, Pentacles
    element = Column(String(20))  # Fire, Water, Air, Earth
    keywords_upright = Column(JSON)  # [&quot;success&quot;, &quot;achievement&quot;, ...]
    keywords_reversed = Column(JSON)
    symbolism = Column(JSON)  # ìƒì§• ì²´ê³„ (ë™ë¬¼, ìƒ‰ìƒ, ìˆ«ì ë“±)
    image_url = Column(String(500))
  
class UserProfile(Base):
    __tablename__ = &quot;user_profile&quot;
  
    user_id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    email = Column(String(255), unique=True, nullable=False)
    nickname = Column(String(100))
    birth_date = Column(DateTime)
    birth_chart = Column(JSON)  # ì ì„±ìˆ  ë°ì´í„°
    created_at = Column(DateTime, default=datetime.utcnow)
  
    readings = relationship(&quot;ReadingSession&quot;, back_populates=&quot;user&quot;)

class ReadingSession(Base):
    __tablename__ = &quot;reading_session&quot;
  
    session_id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey(&quot;user_profile.user_id&quot;))
    question = Column(String(1000), nullable=False)
    spread_type = Column(String(50))
    ai_summary = Column(String(5000))
    processing_time_ms = Column(Integer)  # AI ì²˜ë¦¬ ì‹œê°„ ì¶”ì 
    user_rating = Column(Integer)  # 1-5 ì 
    created_at = Column(DateTime, default=datetime.utcnow)
  
    user = relationship(&quot;UserProfile&quot;, back_populates=&quot;readings&quot;)
    card_selections = relationship(&quot;CardSelection&quot;, back_populates=&quot;session&quot;)

class CardSelection(Base):
    __tablename__ = &quot;card_selection&quot;
  
    selection_id = Column(Integer, primary_key=True, autoincrement=True)
    session_id = Column(UUID(as_uuid=True), ForeignKey(&quot;reading_session.session_id&quot;))
    card_id = Column(Integer, ForeignKey(&quot;tarot_deck.card_id&quot;))
    position_index = Column(Integer)  # 0: ê³¼ê±°, 1: í˜„ì¬, 2: ë¯¸ë˜ ë“±
    is_reversed = Column(Boolean, default=False)
  
    session = relationship(&quot;ReadingSession&quot;, back_populates=&quot;card_selections&quot;)
    card = relationship(&quot;TarotDeck&quot;)
</code></pre>
<h4>1.2 Phase1 Cryptographic Shuffling Engine (ì•”í˜¸í•™ì  ì…”í”Œ ì—”ì§„)</h4>
<p>ì¼ë°˜ì ì¸ <code>random</code> ëª¨ë“ˆì€ ì˜ì‚¬ ë‚œìˆ˜(Pseudo-random)ë¡œ íŒ¨í„´ì´ ì˜ˆì¸¡ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <strong>ì§„ì •í•œ ìš°ì—°</strong>ì„ ìœ„í•´ ì•”í˜¸í•™ì  ë‚œìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p><strong>ê¸°ìˆ  ìŠ¤íƒ:</strong></p>
<ul>
<li>Python <code>secrets</code> ëª¨ë“ˆ</li>
<li><code>SystemRandom</code> í´ë˜ìŠ¤</li>
</ul>
<p><strong>êµ¬í˜„ ë¡œì§:</strong></p>
<pre><code class="language-python">import secrets
import math
from typing import List

class CryptographicShuffler:
    &quot;&quot;&quot;
    ì•”í˜¸í•™ì ìœ¼ë¡œ ì•ˆì „í•œ íƒ€ë¡œ ë± ì…”í”ŒëŸ¬
    &quot;&quot;&quot;
  
    @staticmethod
    def shuffle_deck(deck: List[int]) -&gt; List[int]:
        &quot;&quot;&quot;
        Fisher-Yates shuffle ì•Œê³ ë¦¬ì¦˜ì„ secrets ëª¨ë“ˆë¡œ êµ¬í˜„
      
        Args:
            deck: ì¹´ë“œ ID ë¦¬ìŠ¤íŠ¸ (0-77)
          
        Returns:
            ì…”í”Œëœ ì¹´ë“œ ID ë¦¬ìŠ¤íŠ¸
        &quot;&quot;&quot;
        shuffled = deck[:]
        n = len(shuffled)
      
        for i in range(n - 1, 0, -1):
            # secrets.randbelow()ë¡œ ì•”í˜¸í•™ì  ë‚œìˆ˜ ìƒì„±
            j = secrets.randbelow(i + 1)
            shuffled[i], shuffled[j] = shuffled[j], shuffled[i]
      
        return shuffled
  
    @staticmethod
    def calculate_entropy(shuffle_results: List[List[int]], deck_size: int = 78) -&gt; float:
        &quot;&quot;&quot;
        ì…”í”Œ ê²°ê³¼ì˜ ì—”íŠ¸ë¡œí”¼ë¥¼ ê³„ì‚°í•˜ì—¬ ë¬´ì‘ìœ„ì„± í’ˆì§ˆ ê²€ì¦
      
        Args:
            shuffle_results: ì—¬ëŸ¬ ë²ˆì˜ ì…”í”Œ ê²°ê³¼
            deck_size: ë± í¬ê¸°
          
        Returns:
            ì—”íŠ¸ë¡œí”¼ ê°’ (ë†’ì„ìˆ˜ë¡ ë¬´ì‘ìœ„ì„±ì´ ì¢‹ìŒ)
        &quot;&quot;&quot;
        # ê° ìœ„ì¹˜ë³„ ì¹´ë“œ ì¶œí˜„ ë¹ˆë„ ê³„ì‚°
        position_frequencies = {}
        for shuffle in shuffle_results:
            for position, card_id in enumerate(shuffle):
                key = f&quot;{position}_{card_id}&quot;
                position_frequencies[key] = position_frequencies.get(key, 0) + 1
      
        # Shannon ì—”íŠ¸ë¡œí”¼ ê³„ì‚°
        total_samples = len(shuffle_results)
        entropy = 0.0
      
        for count in position_frequencies.values():
            probability = count / total_samples
            if probability &gt; 0:
                entropy -= probability * math.log2(probability)
      
        return entropy
  
    @staticmethod
    def audit_shuffle(shuffle_id: str, deck: List[int], result: List[int]) -&gt; dict:
        &quot;&quot;&quot;
        ì…”í”Œì˜ ê³µì •ì„±ì„ ê°ì‚¬(Audit)í•˜ê¸° ìœ„í•œ ë¡œê·¸ ìƒì„±
      
        Args:
            shuffle_id: ì„¸ì…˜ ID
            deck: ì›ë³¸ ë±
            result: ì…”í”Œ ê²°ê³¼
          
        Returns:
            ê°ì‚¬ ë¡œê·¸ ë”•ì…”ë„ˆë¦¬
        &quot;&quot;&quot;
        return {
            &quot;shuffle_id&quot;: shuffle_id,
            &quot;timestamp&quot;: datetime.utcnow().isoformat(),
            &quot;algorithm&quot;: &quot;Fisher-Yates with secrets.randbelow&quot;,
            &quot;deck_size&quot;: len(deck),
            &quot;first_three_cards&quot;: result[:3],  # ì• 3ì¥ë§Œ ë¡œê·¸ì— ê¸°ë¡
            &quot;shuffle_hash&quot;: hash(tuple(result))  # ê²°ê³¼ ê²€ì¦ìš© í•´ì‹œ
        }
</code></pre>
<p><strong>ê²€ì¦ ë¡œì§:</strong></p>
<p>ì…”í”Œ í›„ ê²°ê³¼ì˜ ì—”íŠ¸ë¡œí”¼ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê²¨ ì…”í”Œì˜ ê³µì •ì„±ì„ ì‹œìŠ¤í…œ ë‚´ë¶€ì ìœ¼ë¡œ ê°ì‚¬(Audit) ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„í•©ë‹ˆë‹¤.</p>
<hr />
<h2>ğŸ—ï¸ Phase 2. ë°±ì—”ë“œ ì•„í‚¤í…ì²˜ ë° API ê°œë°œ</h2>
<h3>Phase 2 - The Skeleton (ë°±ì—”ë“œ ê³¨ê²©)</h3>
<p><strong>ëª©í‘œ:</strong> ê³ ì„±ëŠ¥ ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•œ ê³„ì¸µí˜• ì•„í‚¤í…ì²˜(Layered Architecture)ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>
<h4>2.1 Phase2 FastAPI Async Architecture (ë¹„ë™ê¸° ì•„í‚¤í…ì²˜)</h4>
<p><strong>í•µì‹¬ ì„¤ê³„ ì›ì¹™:</strong></p>
<ul>
<li><strong>Dependency Injection (ì˜ì¡´ì„± ì£¼ì…)</strong>: DB ì„¸ì…˜, ì¸ì¦ ëª¨ë“ˆ ë“±ì„ <code>Depends()</code>ë¡œ ì£¼ì…í•˜ì—¬ í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í™•ë³´</li>
<li><strong>Pydantic V2</strong>: ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ ë° ì§ë ¬í™” ì†ë„ ìµœì í™”</li>
<li><strong>Layer Separation</strong>: ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬</li>
</ul>
<p><strong>ê³„ì¸µ êµ¬ì¡°:</strong></p>
<pre><code>í”„ë¡œì íŠ¸ ë£¨íŠ¸/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ routers/           # URL ì—”ë“œí¬ì¸íŠ¸ ì •ì˜
â”‚   â”‚   â”‚   â”œâ”€â”€ cards.py
â”‚   â”‚   â”‚   â”œâ”€â”€ readings.py
â”‚   â”‚   â”‚   â””â”€â”€ users.py
â”‚   â”‚   â””â”€â”€ dependencies.py    # ì˜ì¡´ì„± ì£¼ì… í•¨ìˆ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py          # í™˜ê²½ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ security.py        # ì¸ì¦/ì¸ê°€
â”‚   â”‚   â””â”€â”€ shuffler.py        # ì…”í”Œ ì—”ì§„
â”‚   â”‚
â”‚   â”œâ”€â”€ services/              # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ deck_service.py
â”‚   â”‚   â”œâ”€â”€ interpretation_service.py
â”‚   â”‚   â””â”€â”€ user_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/          # DB CRUD ì „ë‹´
â”‚   â”‚   â”œâ”€â”€ card_repository.py
â”‚   â”‚   â””â”€â”€ reading_repository.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                # SQLAlchemy ëª¨ë¸
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”‚
â”‚   â””â”€â”€ schemas/               # Pydantic ìŠ¤í‚¤ë§ˆ
â”‚       â”œâ”€â”€ card_schemas.py
â”‚       â””â”€â”€ reading_schemas.py
â”‚
â””â”€â”€ main.py                    # FastAPI ì•± ì§„ì…ì 
</code></pre>
<p><strong>FastAPI êµ¬í˜„ ì˜ˆì‹œ:</strong></p>
<pre><code class="language-python"># main.py
from fastapi import FastAPI
from app.api.routers import cards, readings, users
from app.core.config import settings

app = FastAPI(
    title=&quot;PyTarot API&quot;,
    description=&quot;AI-Powered Tarot Reading Platform&quot;,
    version=&quot;1.0.0&quot;
)

# ë¼ìš°í„° ë“±ë¡
app.include_router(cards.router, prefix=&quot;/api/cards&quot;, tags=[&quot;cards&quot;])
app.include_router(readings.router, prefix=&quot;/api/readings&quot;, tags=[&quot;readings&quot;])
app.include_router(users.router, prefix=&quot;/api/users&quot;, tags=[&quot;users&quot;])

@app.get(&quot;/&quot;)
async def root():
    return {&quot;message&quot;: &quot;Welcome to PyTarot API&quot;}


# app/api/routers/readings.py
from fastapi import APIRouter, Depends, HTTPException
from app.services.deck_service import DeckService
from app.services.interpretation_service import InterpretationService
from app.schemas.reading_schemas import ReadingRequest, ReadingResponse
from app.api.dependencies import get_deck_service, get_interpretation_service

router = APIRouter()

@router.post(&quot;/shuffle&quot;, response_model=dict)
async def shuffle_deck(
    deck_service: DeckService = Depends(get_deck_service)
):
    &quot;&quot;&quot;ë± ì…”í”Œ ì—”ë“œí¬ì¸íŠ¸&quot;&quot;&quot;
    session_id = await deck_service.create_shuffled_session()
    return {&quot;session_id&quot;: session_id, &quot;status&quot;: &quot;shuffled&quot;}

@router.post(&quot;/draw&quot;, response_model=ReadingResponse)
async def draw_cards(
    request: ReadingRequest,
    deck_service: DeckService = Depends(get_deck_service),
    interpretation_service: InterpretationService = Depends(get_interpretation_service)
):
    &quot;&quot;&quot;ì¹´ë“œ ë½‘ê¸° ë° í•´ì„ ì—”ë“œí¬ì¸íŠ¸&quot;&quot;&quot;
    # 1. ì¹´ë“œ ë½‘ê¸°
    drawn_cards = await deck_service.draw_cards(
        session_id=request.session_id,
        spread_type=request.spread_type,
        count=request.card_count
    )
  
    # 2. AI í•´ì„ ìƒì„±
    interpretation = await interpretation_service.generate_interpretation(
        question=request.question,
        cards=drawn_cards,
        spread_type=request.spread_type
    )
  
    return ReadingResponse(
        session_id=request.session_id,
        cards=drawn_cards,
        interpretation=interpretation
    )
</code></pre>
<h4>2.2 Phase2 Context-Aware Spread System (ë§¥ë½ ì¸ì‹ ìŠ¤í”„ë ˆë“œ ì‹œìŠ¤í…œ)</h4>
<p>ìŠ¤í”„ë ˆë“œ ë°©ì‹ì„ í•˜ë“œì½”ë”©í•˜ì§€ ì•Šê³ , **ì¢Œí‘œ ì‹œìŠ¤í…œ(Coordinate System)**ìœ¼ë¡œ ì¶”ìƒí™”í•©ë‹ˆë‹¤.</p>
<p><strong>êµ¬í˜„ ë°©ì‹:</strong></p>
<p>ê° ìŠ¤í”„ë ˆë“œ(ì¼ˆí‹± í¬ë¡œìŠ¤ ë“±)ë¥¼ JSON ì„¤ì • íŒŒì¼ë¡œ ê´€ë¦¬:</p>
<pre><code class="language-json">{
  &quot;spread_types&quot;: {
    &quot;three_card&quot;: {
      &quot;name&quot;: &quot;Three Card Spread&quot;,
      &quot;name_kr&quot;: &quot;ì“°ë¦¬ì¹´ë“œ ìŠ¤í”„ë ˆë“œ&quot;,
      &quot;card_count&quot;: 3,
      &quot;positions&quot;: [
        {
          &quot;index&quot;: 0,
          &quot;meaning&quot;: &quot;past&quot;,
          &quot;meaning_kr&quot;: &quot;ê³¼ê±°&quot;,
          &quot;x&quot;: 0,
          &quot;y&quot;: 0,
          &quot;description&quot;: &quot;ê³¼ê±°ì˜ ìƒí™©ê³¼ ì˜í–¥&quot;
        },
        {
          &quot;index&quot;: 1,
          &quot;meaning&quot;: &quot;present&quot;,
          &quot;meaning_kr&quot;: &quot;í˜„ì¬&quot;,
          &quot;x&quot;: 150,
          &quot;y&quot;: 0,
          &quot;description&quot;: &quot;í˜„ì¬ì˜ ìƒí™©ê³¼ ë„ì „&quot;
        },
        {
          &quot;index&quot;: 2,
          &quot;meaning&quot;: &quot;future&quot;,
          &quot;meaning_kr&quot;: &quot;ë¯¸ë˜&quot;,
          &quot;x&quot;: 300,
          &quot;y&quot;: 0,
          &quot;description&quot;: &quot;ë¯¸ë˜ì˜ ê°€ëŠ¥ì„±ê³¼ ê²°ê³¼&quot;
        }
      ]
    },
    &quot;celtic_cross&quot;: {
      &quot;name&quot;: &quot;Celtic Cross&quot;,
      &quot;name_kr&quot;: &quot;ì¼ˆí‹± í¬ë¡œìŠ¤&quot;,
      &quot;card_count&quot;: 10,
      &quot;positions&quot;: [
        {&quot;index&quot;: 0, &quot;meaning&quot;: &quot;present&quot;, &quot;meaning_kr&quot;: &quot;í˜„ì¬ ìƒí™©&quot;, &quot;x&quot;: 200, &quot;y&quot;: 200},
        {&quot;index&quot;: 1, &quot;meaning&quot;: &quot;challenge&quot;, &quot;meaning_kr&quot;: &quot;ë„ì „ê³¼ ì¥ì• &quot;, &quot;x&quot;: 200, &quot;y&quot;: 200, &quot;rotation&quot;: 90},
        {&quot;index&quot;: 2, &quot;meaning&quot;: &quot;foundation&quot;, &quot;meaning_kr&quot;: &quot;ê·¼ë³¸ ì›ì¸&quot;, &quot;x&quot;: 200, &quot;y&quot;: 300},
        {&quot;index&quot;: 3, &quot;meaning&quot;: &quot;past&quot;, &quot;meaning_kr&quot;: &quot;ê³¼ê±°&quot;, &quot;x&quot;: 100, &quot;y&quot;: 200},
        {&quot;index&quot;: 4, &quot;meaning&quot;: &quot;crown&quot;, &quot;meaning_kr&quot;: &quot;ìµœì„ ì˜ ê²°ê³¼&quot;, &quot;x&quot;: 200, &quot;y&quot;: 100},
        {&quot;index&quot;: 5, &quot;meaning&quot;: &quot;future&quot;, &quot;meaning_kr&quot;: &quot;ê°€ê¹Œìš´ ë¯¸ë˜&quot;, &quot;x&quot;: 300, &quot;y&quot;: 200},
        {&quot;index&quot;: 6, &quot;meaning&quot;: &quot;self&quot;, &quot;meaning_kr&quot;: &quot;ìì‹ ì˜ íƒœë„&quot;, &quot;x&quot;: 450, &quot;y&quot;: 300},
        {&quot;index&quot;: 7, &quot;meaning&quot;: &quot;environment&quot;, &quot;meaning_kr&quot;: &quot;ì£¼ë³€ í™˜ê²½&quot;, &quot;x&quot;: 450, &quot;y&quot;: 250},
        {&quot;index&quot;: 8, &quot;meaning&quot;: &quot;hopes_fears&quot;, &quot;meaning_kr&quot;: &quot;í¬ë§ê³¼ ë‘ë ¤ì›€&quot;, &quot;x&quot;: 450, &quot;y&quot;: 200},
        {&quot;index&quot;: 9, &quot;meaning&quot;: &quot;outcome&quot;, &quot;meaning_kr&quot;: &quot;ìµœì¢… ê²°ê³¼&quot;, &quot;x&quot;: 450, &quot;y&quot;: 150}
      ]
    }
  }
}
</code></pre>
<p><strong>Python êµ¬í˜„:</strong></p>
<pre><code class="language-python"># app/core/spread_manager.py
import json
from typing import Dict, List
from pathlib import Path

class SpreadManager:
    &quot;&quot;&quot;ìŠ¤í”„ë ˆë“œ ì„¤ì • ê´€ë¦¬ì&quot;&quot;&quot;
  
    def __init__(self, config_path: str = &quot;config/spreads.json&quot;):
        self.config_path = Path(config_path)
        self.spreads = self._load_spreads()
  
    def _load_spreads(self) -&gt; Dict:
        &quot;&quot;&quot;JSON íŒŒì¼ì—ì„œ ìŠ¤í”„ë ˆë“œ ì„¤ì • ë¡œë“œ&quot;&quot;&quot;
        with open(self.config_path, 'r', encoding='utf-8') as f:
            return json.load(f)
  
    def get_spread(self, spread_type: str) -&gt; Dict:
        &quot;&quot;&quot;íŠ¹ì • ìŠ¤í”„ë ˆë“œ ì •ë³´ ë°˜í™˜&quot;&quot;&quot;
        return self.spreads['spread_types'].get(spread_type)
  
    def get_position_meanings(self, spread_type: str) -&gt; List[str]:
        &quot;&quot;&quot;ìŠ¤í”„ë ˆë“œì˜ ìœ„ì¹˜ë³„ ì˜ë¯¸ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜&quot;&quot;&quot;
        spread = self.get_spread(spread_type)
        if not spread:
            return []
        return [pos['meaning_kr'] for pos in spread['positions']]
  
    def get_card_count(self, spread_type: str) -&gt; int:
        &quot;&quot;&quot;ìŠ¤í”„ë ˆë“œì— í•„ìš”í•œ ì¹´ë“œ ìˆ˜ ë°˜í™˜&quot;&quot;&quot;
        spread = self.get_spread(spread_type)
        return spread['card_count'] if spread else 0
</code></pre>
<p><strong>ì´ì :</strong></p>
<ul>
<li>ì•± í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ ì¢Œí‘œ ë°ì´í„°ë¥¼ ë°›ì•„ ì¹´ë“œë¥¼ ì‹œê°ì ìœ¼ë¡œ ë°°ì¹˜</li>
<li>ë°±ì—”ë“œ ìˆ˜ì • ì—†ì´ ìƒˆë¡œìš´ ìŠ¤í”„ë ˆë“œ ì¶”ê°€ ê°€ëŠ¥</li>
<li>ë‹¤êµ­ì–´ ì§€ì› ìš©ì´</li>
</ul>
<hr />
<h2>ğŸ¤– Phase 3. AI ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë° í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</h2>
<h3>Phase 3 - The Intelligence (ì§€ëŠ¥ ë ˆì´ì–´)</h3>
<p><strong>ëª©í‘œ:</strong> ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ ìƒì„±ì„ ë„˜ì–´, ì „ë¬¸ íƒ€ë¡œ ë¦¬ë”ì˜ í™”ë²•ì„ êµ¬ì‚¬í•˜ëŠ” AI íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>
<h4>3.1 Phase3 LLM Pipeline with LangChain (LLM íŒŒì´í”„ë¼ì¸)</h4>
<p>AI ë‹µë³€ ìƒì„± ê³¼ì •ì„ ì²´ê³„ì ì¸ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ êµ¬ì„±í•©ë‹ˆë‹¤.</p>
<p><strong>Context Injection (ë§¥ë½ ì£¼ì…):</strong></p>
<pre><code class="language-python"># app/services/interpretation_service.py
from langchain.prompts import ChatPromptTemplate
from langchain.chat_models import ChatOpenAI
from langchain.schema import SystemMessage, HumanMessage
from typing import List, Dict

class InterpretationService:
    &quot;&quot;&quot;AI ê¸°ë°˜ íƒ€ë¡œ í•´ì„ ì„œë¹„ìŠ¤&quot;&quot;&quot;
  
    def __init__(self, api_key: str, model: str = &quot;gpt-4&quot;):
        self.llm = ChatOpenAI(
            api_key=api_key,
            model=model,
            temperature=0.7,  # ì°½ì˜ì„±ê³¼ ì¼ê´€ì„±ì˜ ê· í˜•
            streaming=True
        )
        self.system_prompt = self._create_system_prompt()
  
    def _create_system_prompt(self) -&gt; str:
        &quot;&quot;&quot;ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ìƒì„±&quot;&quot;&quot;
        return &quot;&quot;&quot;
ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ ì‹¬ë¦¬ ìƒë‹´ê°€ì´ì íƒ€ë¡œ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤.

**ë‹¹ì‹ ì˜ ì—­í• :**
- ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ ë½‘íŒ íƒ€ë¡œ ì¹´ë“œë“¤ì„ í•´ì„í•©ë‹ˆë‹¤
- ê° ì¹´ë“œì˜ ìƒì§•ê³¼ ìœ„ì¹˜ë¥¼ ê³ ë ¤í•˜ì—¬ ì¢…í•©ì ì¸ ìŠ¤í† ë¦¬ë¥¼ ë§Œë“­ë‹ˆë‹¤
- ê³µê°ì ì´ê³  ë”°ëœ»í•˜ë©°, ì•½ê°„ ì‹ ë¹„ë¡œìš´ ì–´ì¡°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
- ë‹¨ìˆœíˆ í‚¤ì›Œë“œë¥¼ ë‚˜ì—´í•˜ì§€ ì•Šê³ , ì¹´ë“œ ê°„ì˜ ê´€ê³„ì™€ íë¦„ì„ ì„¤ëª…í•©ë‹ˆë‹¤

**ì£¼ì˜ì‚¬í•­:**
- ì œê³µëœ ì¹´ë“œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œë§Œ í•´ì„í•©ë‹ˆë‹¤ (í™˜ê° ë°©ì§€)
- ì§€ë‚˜ì¹˜ê²Œ ë¶€ì •ì ì´ê±°ë‚˜ ê³µí¬ë¥¼ ì¡°ì¥í•˜ëŠ” í‘œí˜„ì€ í”¼í•©ë‹ˆë‹¤
- ì‚¬ìš©ìì—ê²Œ ì„ íƒê¶Œê³¼ ììœ ì˜ì§€ê°€ ìˆìŒì„ í•­ìƒ ê°•ì¡°í•©ë‹ˆë‹¤
- êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ í¬í•¨í•©ë‹ˆë‹¤

**ì‘ë‹µ êµ¬ì¡°:**
1. ì „ì²´ì ì¸ ë©”ì‹œì§€ (ì¹´ë“œë“¤ì´ ì „í•˜ëŠ” í•µì‹¬ ë©”ì‹œì§€)
2. ê° ìœ„ì¹˜ë³„ ì¹´ë“œ í•´ì„ (ê³¼ê±°-í˜„ì¬-ë¯¸ë˜ì˜ íë¦„)
3. ì¢…í•© ì¡°ì–¸ (ì‹¤ì²œ ê°€ëŠ¥í•œ ê°€ì´ë˜ìŠ¤)
&quot;&quot;&quot;
  
    async def generate_interpretation(
        self,
        question: str,
        cards: List[Dict],
        spread_type: str
    ) -&gt; str:
        &quot;&quot;&quot;
        AI í•´ì„ ìƒì„±
      
        Args:
            question: ì‚¬ìš©ì ì§ˆë¬¸
            cards: ë½‘íŒ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ (ì¹´ë“œ ì •ë³´ + ìœ„ì¹˜ + ì •/ì—­ë°©í–¥)
            spread_type: ìŠ¤í”„ë ˆë“œ íƒ€ì…
          
        Returns:
            AIê°€ ìƒì„±í•œ í•´ì„ í…ìŠ¤íŠ¸
        &quot;&quot;&quot;
        # ì¹´ë“œ ì •ë³´ë¥¼ í”„ë¡¬í”„íŠ¸ì— ì£¼ì…í•  í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        cards_context = self._format_cards_context(cards)
      
        # ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ìƒì„±
        user_prompt = f&quot;&quot;&quot;
**ì‚¬ìš©ìì˜ ì§ˆë¬¸:** {question}

**ì„ íƒëœ ìŠ¤í”„ë ˆë“œ:** {spread_type}

**ë½‘íŒ ì¹´ë“œë“¤:**
{cards_context}

ìœ„ ì¹´ë“œë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•œ íƒ€ë¡œ ë¦¬ë”©ì„ í•´ì£¼ì„¸ìš”.
&quot;&quot;&quot;
      
        # LLM í˜¸ì¶œ
        messages = [
            SystemMessage(content=self.system_prompt),
            HumanMessage(content=user_prompt)
        ]
      
        response = await self.llm.agenerate([messages])
        return response.generations[0][0].text
  
    def _format_cards_context(self, cards: List[Dict]) -&gt; str:
        &quot;&quot;&quot;ì¹´ë“œ ì •ë³´ë¥¼ í”„ë¡¬í”„íŠ¸ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…&quot;&quot;&quot;
        formatted = []
      
        for card in cards:
            position = card['position_meaning']
            name = card['name_kr']
            orientation = &quot;ì •ë°©í–¥&quot; if not card['is_reversed'] else &quot;ì—­ë°©í–¥&quot;
            keywords = card['keywords_upright'] if not card['is_reversed'] else card['keywords_reversed']
          
            card_text = f&quot;&quot;&quot;
ìœ„ì¹˜: {position}
ì¹´ë“œ: {name} ({orientation})
í•µì‹¬ í‚¤ì›Œë“œ: {', '.join(keywords)}
ìƒì§•: {card.get('symbolism', 'í•´ë‹¹ ì—†ìŒ')}
&quot;&quot;&quot;
            formatted.append(card_text.strip())
      
        return &quot;\n\n&quot;.join(formatted)
</code></pre>
<p><strong>Hallucination Control (í™˜ê° ì œì–´):</strong></p>
<ul>
<li>ì¹´ë“œì˜ ê¸°ë³¸ ì˜ë¯¸ëŠ” DBì—ì„œ ê°€ì ¸ì˜¨ í…ìŠ¤íŠ¸ë¥¼ í”„ë¡¬í”„íŠ¸ì— 'Fact'ë¡œ ì œê³µ</li>
<li>AIê°€ ì—†ëŠ” ì˜ë¯¸ë¥¼ ì§€ì–´ë‚´ì§€ ì•Šë„ë¡ í†µì œ</li>
<li>Temperature ê°’ì„ 0.7ë¡œ ì„¤ì •í•˜ì—¬ ì°½ì˜ì„±ê³¼ ì¼ê´€ì„± ê· í˜•</li>
</ul>
<h4>3.2 Phase3 Streaming Response (ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°)</h4>
<p>íƒ€ë¡œ ë¦¬ë”©ì€ í…ìŠ¤íŠ¸ê°€ ê¸¸ê¸° ë•Œë¬¸ì—(500ì ì´ìƒ), ì‚¬ìš©ìê°€ ê¸°ë‹¤ë¦¬ì§€ ì•Šë„ë¡ <strong>íƒ€ì´í•‘ íš¨ê³¼</strong>ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
<p><strong>SSE (Server-Sent Events) êµ¬í˜„:</strong></p>
<pre><code class="language-python"># app/api/routers/readings.py
from fastapi import APIRouter
from fastapi.responses import StreamingResponse
from app.services.interpretation_service import InterpretationService
import asyncio

router = APIRouter()

@router.post(&quot;/interpret/stream&quot;)
async def interpret_stream(
    request: InterpretationRequest,
    service: InterpretationService = Depends(get_interpretation_service)
):
    &quot;&quot;&quot;AI í•´ì„ì„ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë°˜í™˜&quot;&quot;&quot;
  
    async def generate():
        &quot;&quot;&quot;ë¹„ë™ê¸° ì œë„ˆë ˆì´í„°&quot;&quot;&quot;
        async for chunk in service.stream_interpretation(
            question=request.question,
            cards=request.cards,
            spread_type=request.spread_type
        ):
            # SSE í˜•ì‹ìœ¼ë¡œ ì „ì†¡
            yield f&quot;data: {chunk}\n\n&quot;
            await asyncio.sleep(0.01)  # íƒ€ì´í•‘ íš¨ê³¼
  
    return StreamingResponse(
        generate(),
        media_type=&quot;text/event-stream&quot;
    )


# app/services/interpretation_service.py (streaming ë©”ì„œë“œ ì¶”ê°€)
async def stream_interpretation(
    self,
    question: str,
    cards: List[Dict],
    spread_type: str
):
    &quot;&quot;&quot;ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ìœ¼ë¡œ AI í•´ì„ ìƒì„±&quot;&quot;&quot;
    cards_context = self._format_cards_context(cards)
    user_prompt = f&quot;ì§ˆë¬¸: {question}\n\nì¹´ë“œ: {cards_context}&quot;
  
    messages = [
        SystemMessage(content=self.system_prompt),
        HumanMessage(content=user_prompt)
    ]
  
    # LangChainì˜ ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ ì‚¬ìš©
    async for chunk in self.llm.astream(messages):
        if hasattr(chunk, 'content'):
            yield chunk.content
</code></pre>
<p><strong>UX íš¨ê³¼:</strong></p>
<ul>
<li>AIê°€ í•œ ê¸€ìì”© ìƒì„±í•˜ëŠ” ê²ƒì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì „ì†¡</li>
<li>ë§ˆì¹˜ ì‹¤ì œ ìƒë‹´ì‚¬ê°€ ë§í•˜ëŠ” ë“¯í•œ ëª°ì…ê° ì œê³µ</li>
<li>ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„ ì²´ê° ê°ì†Œ</li>
</ul>
<hr />
<h2>ğŸš€ Phase 4. ì¸í”„ë¼ êµ¬ì¶• ë° ë°°í¬ ì „ëµ</h2>
<h3>Phase 4 - The Delivery (ë°°í¬ ë° ìš´ì˜)</h3>
<p><strong>ëª©í‘œ:</strong> ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ê³¼ ìë™í™”ëœ ë°°í¬ í”„ë¡œì„¸ìŠ¤ë¥¼ í™•ë¦½í•©ë‹ˆë‹¤.</p>
<h4>4.1 Phase4 Docker Containerization (ì»¨í…Œì´ë„ˆí™”)</h4>
<p><strong>Multi-stage Build ì „ëµ:</strong></p>
<pre><code class="language-dockerfile"># Dockerfile
# ============= Stage 1: Build =============
FROM python:3.11-slim as builder

WORKDIR /app

# ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì„¤ì¹˜
RUN apt-get update &amp;&amp; apt-get install -y \
    gcc \
    postgresql-client \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# Python ì˜ì¡´ì„± ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir --user -r requirements.txt

# ============= Stage 2: Runtime =============
FROM python:3.11-slim

WORKDIR /app

# Stage 1ì—ì„œ ë¹Œë“œí•œ íŒ¨í‚¤ì§€ë§Œ ë³µì‚¬
COPY --from=builder /root/.local /root/.local

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY ./app ./app
COPY ./config ./config
COPY ./main.py .

# PATHì— ë¡œì»¬ bin ì¶”ê°€
ENV PATH=/root/.local/bin:$PATH

# ë¹„ë£¨íŠ¸ ì‚¬ìš©ì ìƒì„± (ë³´ì•ˆ)
RUN useradd -m -u 1000 pytarot &amp;&amp; \
    chown -R pytarot:pytarot /app
USER pytarot

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8000

# í—¬ìŠ¤ì²´í¬
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD python -c &quot;import requests; requests.get('http://localhost:8000/health')&quot;

# ì‹¤í–‰ ëª…ë ¹
CMD [&quot;uvicorn&quot;, &quot;main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;]
</code></pre>
<p><strong>Docker Compose êµ¬ì„±:</strong></p>
<pre><code class="language-yaml"># docker-compose.yml
version: '3.8'

services:
  api:
    build: .
    container_name: pytarot_api
    ports:
      - &quot;8000:8000&quot;
    environment:
      - DATABASE_URL=postgresql://pytarot:password@db:5432/pytarot_db
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    networks:
      - pytarot_network
    restart: unless-stopped

  db:
    image: postgres:15-alpine
    container_name: pytarot_db
    environment:
      - POSTGRES_USER=pytarot
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=pytarot_db
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - pytarot_network
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: pytarot_redis
    volumes:
      - redis_data:/data
    networks:
      - pytarot_network
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    container_name: pytarot_nginx
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
      - ./static:/usr/share/nginx/html/static:ro
    depends_on:
      - api
    networks:
      - pytarot_network
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:

networks:
  pytarot_network:
    driver: bridge
</code></pre>
<p><strong>ì´ì :</strong></p>
<ul>
<li>ì´ë¯¸ì§€ í¬ê¸° ìµœì†Œí™” (Multi-stage build)</li>
<li>ë³´ì•ˆ ê°•í™” (ë¹„ë£¨íŠ¸ ì‚¬ìš©ì ì‹¤í–‰)</li>
<li>ë¡œì»¬ ê°œë°œ í™˜ê²½ í†µì¼</li>
</ul>
<h4>4.2 Phase4 Deployment Pipeline (ë°°í¬ íŒŒì´í”„ë¼ì¸)</h4>
<p><strong>Web Server Interface:</strong></p>
<pre><code class="language-bash"># Gunicorn + Uvicorn ì¡°í•©
gunicorn main:app \
    --workers 4 \
    --worker-class uvicorn.workers.UvicornWorker \
    --bind 0.0.0.0:8000 \
    --timeout 120 \
    --graceful-timeout 30 \
    --log-level info
</code></pre>
<p><strong>Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •:</strong></p>
<pre><code class="language-nginx"># nginx.conf
upstream pytarot_api {
    server api:8000;
}

server {
    listen 80;
    server_name pytarot.example.com;
  
    # HTTP to HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name pytarot.example.com;
  
    # SSL ì¸ì¦ì„œ
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
  
    # ì •ì  íŒŒì¼ (ì¹´ë“œ ì´ë¯¸ì§€)
    location /static/ {
        alias /usr/share/nginx/html/static/;
        expires 30d;
        add_header Cache-Control &quot;public, immutable&quot;;
    }
  
    # API í”„ë¡ì‹œ
    location /api/ {
        proxy_pass http://pytarot_api;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      
        # SSEë¥¼ ìœ„í•œ ì„¤ì •
        proxy_buffering off;
        proxy_cache off;
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
    }
  
    # í—¬ìŠ¤ì²´í¬
    location /health {
        proxy_pass http://pytarot_api/health;
        access_log off;
    }
}
</code></pre>
<h4>4.3 Phase4 Monitoring &amp; Logging (ëª¨ë‹ˆí„°ë§)</h4>
<p><strong>Sentry ì—°ë™:</strong></p>
<pre><code class="language-python"># main.py
import sentry_sdk
from sentry_sdk.integrations.fastapi import FastApiIntegration
from sentry_sdk.integrations.sqlalchemy import SqlalchemyIntegration

sentry_sdk.init(
    dsn=&quot;https://your-sentry-dsn&quot;,
    integrations=[
        FastApiIntegration(),
        SqlalchemyIntegration(),
    ],
    traces_sample_rate=0.1,  # 10%ì˜ íŠ¸ëœì­ì…˜ ì¶”ì 
    environment=&quot;production&quot;
)

app = FastAPI()
</code></pre>
<p><strong>êµ¬ì¡°í™”ëœ ë¡œê¹…:</strong></p>
<pre><code class="language-python"># app/core/logger.py
import logging
import json
from datetime import datetime

class JSONFormatter(logging.Formatter):
    &quot;&quot;&quot;JSON í˜•ì‹ ë¡œê·¸ í¬ë§·í„°&quot;&quot;&quot;
  
    def format(self, record):
        log_data = {
            &quot;timestamp&quot;: datetime.utcnow().isoformat(),
            &quot;level&quot;: record.levelname,
            &quot;message&quot;: record.getMessage(),
            &quot;module&quot;: record.module,
            &quot;function&quot;: record.funcName,
        }
      
        if record.exc_info:
            log_data[&quot;exception&quot;] = self.formatException(record.exc_info)
      
        return json.dumps(log_data, ensure_ascii=False)

# ë¡œê±° ì„¤ì •
logger = logging.getLogger(&quot;pytarot&quot;)
handler = logging.StreamHandler()
handler.setFormatter(JSONFormatter())
logger.addHandler(handler)
logger.setLevel(logging.INFO)
</code></pre>
<hr />
<h2>ğŸ’¡ Phase 5. ì „ë¬¸ê°€ ì œì–¸ ë° ë‹¤ìŒ ë‹¨ê³„</h2>
<h3>Phase 5 - Next Actions (ë‹¤ìŒ ì•¡ì…˜)</h3>
<h4>5.1 Phase5 ë¦¬ìŠ¤í¬ ë¶„ì„ (Risk Analysis)</h4>
<p><strong>ê°€ì¥ ë¦¬ìŠ¤í¬ê°€ ë†’ì€ ë¶€ë¶„:</strong> <strong>Phase 3 (AI í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§)</strong></p>
<p>ì´ìœ :</p>
<ul>
<li>ì¹´ë“œì˜ ì˜ë¯¸ë¥¼ ë‹¨ìˆœíˆ ë‚˜ì—´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì¹´ë“œ ê°„ì˜ 'ìŠ¤í† ë¦¬'ë¥¼ ì—®ì–´ë‚´ëŠ” ê²ƒì´ í•µì‹¬</li>
<li>LLMì˜ í™˜ê° í˜„ìƒ ì œì–´ê°€ ì–´ë ¤ì›€</li>
<li>ì‚¬ìš©ì ë§Œì¡±ë„ì— ì§ì ‘ì ì¸ ì˜í–¥</li>
</ul>
<h4>5.2 Phase5 ìš°ì„ ìˆœìœ„ ì¶”ì²œ (Priority Recommendation)</h4>
<p><strong>ë‹¤ìŒ ë‹¨ê³„ë¡œ ì¶”ì²œí•˜ëŠ” ì‘ì—…:</strong></p>
<p><strong>ì˜µì…˜ 1: Core Prototype ê°œë°œ</strong></p>
<ul>
<li><code>secrets</code> ì…”í”Œ ì—”ì§„ê³¼ ê¸°ë³¸ FastAPI êµ¬ì¡°ê°€ ë‹´ê¸´ ì „ì²´ í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° ë° íŒŒì¼ ì½”ë“œ ìƒì„±</li>
<li><strong>ì˜ˆìƒ ì†Œìš”</strong>: 1ì£¼</li>
<li><strong>ì¥ì </strong>: ë¹ ë¥¸ ê²€ì¦ ë° ë°ëª¨ ê°€ëŠ¥</li>
</ul>
<p><strong>ì˜µì…˜ 2: Prompt Engineering ì‹¬í™”</strong></p>
<ul>
<li>íƒ€ë¡œ ë¦¬ë”©ì˜ í’ˆì§ˆì„ ê²°ì •ì§“ëŠ” LangChainìš© ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿(ìƒì„¸ ë²„ì „) ì‘ì„±</li>
<li>ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ë³„ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸</li>
<li><strong>ì˜ˆìƒ ì†Œìš”</strong>: 1ì£¼</li>
<li><strong>ì¥ì </strong>: ì„œë¹„ìŠ¤ í’ˆì§ˆ í•µì‹¬ í™•ë³´</li>
</ul>
<h4>5.3 Phase5 ì„±ê³µ ì§€í‘œ (Success Metrics)</h4>
<p><strong>ê¸°ìˆ ì  KPI:</strong></p>
<ul>
<li>API ì‘ë‹µ ì‹œê°„: í‰ê·  &lt; 2ì´ˆ (AI ìƒì„± ì œì™¸)</li>
<li>AI ìŠ¤íŠ¸ë¦¬ë° ì²« ì‘ë‹µ: &lt; 1ì´ˆ</li>
<li>ì‹œìŠ¤í…œ ê°€ìš©ì„±: &gt; 99.9%</li>
<li>ì…”í”Œ ì—”íŠ¸ë¡œí”¼: &gt; 6.0</li>
</ul>
<p><strong>ë¹„ì¦ˆë‹ˆìŠ¤ KPI:</strong></p>
<ul>
<li>ì‚¬ìš©ì ë§Œì¡±ë„ (í‰ì ): &gt; 4.5/5</li>
<li>ì¬ë°©ë¬¸ìœ¨: &gt; 60%</li>
<li>AI ì‘ë‹µ ìˆ˜ìš©ë¥ : &gt; 80%</li>
</ul>
<hr />
<h2>ğŸ“Š ë¶€ë¡: ì „ì²´ ì‹œìŠ¤í…œ í”Œë¡œìš°</h2>
<h3>Appendix - System Flow</h3>
<pre><code>ì‚¬ìš©ì ìš”ì²­
    â†“
[API Gateway] - ì¸ì¦/ì†ë„ ì œí•œ
    â†“
[Deck Service] - secrets ê¸°ë°˜ ì…”í”Œ
    â†“
[Card Selection] - ìŠ¤í”„ë ˆë“œ ê·œì¹™ ì ìš©
    â†“
[DB Repository] - ì¹´ë“œ ì •ë³´ ì¡°íšŒ
    â†“
[Interpretation Service]
    â”œâ”€ í”„ë¡¬í”„íŠ¸ ìƒì„±
    â”œâ”€ LLM í˜¸ì¶œ (LangChain)
    â””â”€ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
    â†“
[Response] - SSEë¡œ í´ë¼ì´ì–¸íŠ¸ ì „ì†¡
    â†“
ì‚¬ìš©ì UIì— ì‹¤ì‹œê°„ í‘œì‹œ
</code></pre>
<hr />
<p><em>ì´ ì‹¬í™” ê¸°ìˆ  ëª…ì„¸ì„œëŠ” PyTarot í”„ë¡œì íŠ¸ë¥¼ ì‹¤ì œ ìƒìš© ì„œë¹„ìŠ¤ ìˆ˜ì¤€ìœ¼ë¡œ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì¢…í•©ì ì¸ ê°€ì´ë“œì´ë©°, ë°ì´í„°-ë°±ì—”ë“œ-ì§€ëŠ¥-ì¸í”„ë¼ì˜ 4ë‹¨ê³„ ì•„í‚¤í…ì²˜ë¥¼ í†µí•´ í™•ì¥ ê°€ëŠ¥í•˜ê³  ì•ˆì •ì ì¸ AI íƒ€ë¡œ í”Œë«í¼ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</em></p>

      </body>
    </html>